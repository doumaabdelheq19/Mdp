{% extends 'base.html.twig' %}

{% block title %}
    {{ parent() }} - {{ 'editer_un_soustraitant'|trans }}
{% endblock %}

{% block content %}
<div class="page">
    <div class="table-container-traitements">
        <div class="header headretour">
            <a href="javascript:history.back()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024">
                    <path fill="currentColor" d="M609.408 149.376L277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0a30.59 30.59 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.59 30.59 0 0 0 0-42.688a29.12 29.12 0 0 0-41.728 0"/>
                </svg>
            </a>
            <h2>{{ 'Editer un destinataire'|trans }}</h2>
        </div>

        {{ form_start(form, {"attr": {"class": "needs-validation sous-traitantform", "enctype": "multipart/form-data"}}) }}

        <!-- Société Section -->
        <div class="sectt" style="border-top:none">
            <h3>{{ 'societe'|trans }}</h3>
            <div class="form-group">
                <div class="form-group1">
                    {{ form_label(form.name) }}
                    {{ form_widget(form.name, {'attr': {'class': 'form-control ' ~ ((form_errors(form.name) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.name) | striptags }}</div>
                </div>
                <div class="form-group1">
                    {{ form_label(form.type) }}
                    {{ form_widget(form.type, {'attr': {'class': 'form-control ' ~ ((form_errors(form.type) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.type) | striptags }}</div>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="sectt">
            <h3>{{ 'contact'|trans }}</h3>
            <div class="form-group">
                <div class="form-group1">
                    {{ form_label(form.contactLastName) }}
                    {{ form_widget(form.contactLastName, {'attr': {'class': 'form-control ' ~ ((form_errors(form.contactLastName) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.contactLastName) | striptags }}</div>
                </div>
                <div class="form-group1">
                    {{ form_label(form.contactFirstName) }}
                    {{ form_widget(form.contactFirstName, {'attr': {'class': 'form-control ' ~ ((form_errors(form.contactFirstName) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.contactFirstName) | striptags }}</div>
                </div>
            </div>
            <div class="form-group">
                <div class="form-group1">
                    {{ form_label(form.contactEmail) }}
                    {{ form_widget(form.contactEmail, {'attr': {'class': 'form-control ' ~ ((form_errors(form.contactEmail) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.contactEmail) | striptags }}</div>
                </div>
                <div class="form-group1">
                    {{ form_label(form.contactPhone) }}
                    {{ form_widget(form.contactPhone, {'attr': {'class': 'form-control ' ~ ((form_errors(form.contactPhone) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.contactPhone) | striptags }}</div>
                </div>
            </div>
        </div>

        <!-- Conformité Section -->
        <div class="sectt">
            <h3>{{ 'Conformité'|trans }}</h3>
            <div class="form-group">
                <div class="form-group1">
                    {{ form_label(form.conformity) }}
                    {{ form_widget(form.conformity, {'attr': {'class': 'form-control ' ~ ((form_errors(form.conformity) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.conformity) | striptags }}</div>
                </div>
                <div class="form-group1">
                    {{ form_label(form.privacyPolicyLink) }}
                    {{ form_widget(form.privacyPolicyLink, {'attr': {'class': 'form-control ' ~ ((form_errors(form.privacyPolicyLink) == '') ? '' : 'is-invalid')} }) }}
                    <div class="invalid-feedback">{{ form_errors(form.privacyPolicyLink) | striptags }}</div>
                </div>
            </div>
        </div>

        <!-- Existing Documents Section -->
        <div class="sectt">
            <h3>{{ 'Documents existants'|trans }}</h3>
            <div id="block_old_documents">
                {% for document in subcontractor.documents %}
                    <div class="form-group block_document">
                        <input class="form-control" type="text" placeholder="{{ 'Titre'|trans }}" name="appbundle_subcontractor_documents_{{ document.id }}" value="{{ document.name }}">
                        <a href="{{ path('manager_subcontractor_deletedoc', {'subcontractor': subcontractor.id, 'document': document.id}) }}" class="btn btn-danger" onclick="return confirm('{{ 'Confirmer la suppression de ce fichier ? Cette action actualisera la page, toute autre modification sera perdue.'|trans }}');">
                            <i class="mdi mdi-file-remove"></i>
                        </a>
                        <a href="/uploads/documents/{{ document.filename }}" class="btn btn-info" target="_blank">
                            <i class="mdi mdi-eye"></i>
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- New File Upload Section -->
        <div class="sectt">
            <h3>{{ 'Joindre un fichier'|trans }}</h3>
            <div id="block_documents">
                <button type="button" class="file-button" id="add_document_button">
                    <i class="fa fa-file" aria-hidden="true"></i> {{ 'Joindre un fichier'|trans }}
                </button>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="sectt">
            <button type="submit" class="submit-button">{{ 'enregistrer'|trans }}</button>
        </div>

        {{ form_end(form) }}
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.getElementById("add_document_button").addEventListener("click", function () {
            const div = document.createElement("div");
            div.className = "form-group block_document";

            const nameInput = document.createElement("input");
            nameInput.className = "form-control";
            nameInput.type = "text";
            nameInput.placeholder = "{{ 'Titre'|trans }}";
            nameInput.name = "appbundle_subcontractor_documents_names[]";

            const fileInput = document.createElement("input");
            fileInput.className = "form-control";
            fileInput.type = "file";
            fileInput.name = "appbundle_subcontractor_documents[]";

            const removeButton = document.createElement("button");
            removeButton.className = "btn btn-danger remove_document_button";
            removeButton.type = "button";
            removeButton.innerHTML = `<i class="mdi mdi-file-remove"></i>`;
            removeButton.addEventListener("click", function () {
                div.remove();
            });

            div.appendChild(nameInput);
            div.appendChild(fileInput);
            div.appendChild(removeButton);

            document.getElementById("block_documents").appendChild(div);
        });
    </script>
{% endblock %}
