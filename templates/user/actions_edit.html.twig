{% extends 'base.html.twig' %}

{% block title %}
	{{ parent() }}
	-
	{{ 'Modifier_une_action'|trans }}
{% endblock %}
{% block stylesheets %}
	{{ parent() }}
	<!-- Flatpickr CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}
{% block content %}
<div class="page">
	<div class="table-container-traitements">
		<div class="header headretour">
			<a href="javascript:history.back()">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 1024 1024"><path fill="currentColor" d="M609.408 149.376L277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0a30.59 30.59 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.59 30.59 0 0 0 0-42.688a29.12 29.12 0 0 0-41.728 0"/></svg>
			</a>

			<h2>{{ 'Modifier une action'|trans }}</h2>
		</div>

		{{ form_start(form, {"attr": {"class": "sous-traitantform", "enctype": "multipart/form-data"}}) }}


		<!-- Action Name and Budget -->
		<div class="form-group">
			<div class="form-group1">
				{{ form_label(form.name) }}
				{{ form_widget(form.name, {'attr': {'class': 'form-control ' ~ ((form_errors(form.name) == '') ? '' : 'is-invalid'), 'placeholder': 'Nom de l\'action'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.name) | striptags }}</div>
      </div>

      <div class="form-group1">
        {{ form_label(form.budget) }}
        {{ form_widget(form.budget, {'attr': {'class': 'form-control ' ~ ((form_errors(form.budget) == '') ? '' : 'is-invalid'), 'placeholder': 'Budget'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.budget) | striptags }}</div>
      </div>
    </div>

    <!-- Responsible Information -->
    <div class="sectt">
      <h3>{{ 'responsable_de_laction'|trans }}</h3>
      <div class="form-group">
        <div class="form-group1">
          {{ form_label(form.accountantLastName) }}
          {{ form_widget(form.accountantLastName, {'attr': {'class': 'form-control ' ~ ((form_errors(form.accountantLastName) == '') ? '' : 'is-invalid'), 'placeholder': 'Nom du responsable'}}) }}
          <div class="invalid-feedback">{{ form_errors(form.accountantLastName) | striptags }}</div>
        </div>

        <div class="form-group1">
          {{ form_label(form.accountantFirstName) }}
          {{ form_widget(form.accountantFirstName, {'attr': {'class': 'form-control ' ~ ((form_errors(form.accountantFirstName) == '') ? '' : 'is-invalid'), 'placeholder': 'Prénom du responsable'}}) }}
          <div class="invalid-feedback">{{ form_errors(form.accountantFirstName) | striptags }}</div>
        </div>
      </div>
      <div class="form-group">
        <div class="form-group1">
          {{ form_label(form.accountantEmail) }}
          {{ form_widget(form.accountantEmail, {'attr': {'class': 'form-control ' ~ ((form_errors(form.accountantEmail) == '') ? '' : 'is-invalid'), 'placeholder': 'Email du responsable'}}) }}
          <div class="invalid-feedback">{{ form_errors(form.accountantEmail) | striptags }}</div>
        </div>

        <div class="form-group1">
          {{ form_label(form.accountantPhone) }}
          {{ form_widget(form.accountantPhone, {'attr': {'class': 'form-control ' ~ ((form_errors(form.accountantPhone) == '') ? '' : 'is-invalid'), 'placeholder': 'Téléphone du responsable'}}) }}
          <div class="invalid-feedback">{{ form_errors(form.accountantPhone) | striptags }}</div>
        </div>
      </div>
    </div>

    <!-- Action Information -->
    <!-- Informations Section -->
<h3 class="mt-4">{{ 'informations'|trans }}</h3>
<div class="form-group">
    <div class="form-group1">
        {{ form_label(form.goal, 'Objectif') }}
        {{ form_widget(form.goal, {'attr': {'class': 'form-control ' ~ ((form_errors(form.goal) == '') ? '' : 'is-invalid'), 'placeholder': 'Objectif'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.goal) | striptags }}</div>
    </div>

    <div class="form-group1">
        {{ form_label(form.information, 'Informations') }}
        {{ form_widget(form.information, {'attr': {'class': 'form-control ' ~ ((form_errors(form.information) == '') ? '' : 'is-invalid'), 'placeholder': 'Informations'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.information) | striptags }}</div>
    </div>
    </div>
<div class="form-group">
    <div class="form-group1">
        {{ form_label(form.usefulLink, 'Lien utile') }}
        {{ form_widget(form.usefulLink, {'attr': {'class': 'form-control ' ~ ((form_errors(form.usefulLink) == '') ? '' : 'is-invalid'), 'placeholder': 'Lien utile'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.usefulLink) | striptags }}</div>
    </div>

    <div class="form-group1">
        {{ form_label(form.setUpDate, 'Date de mise en place souhaitée') }}
        {{ form_widget(form.setUpDate, {'attr': {'class': 'form-control datepicker-js ' ~ ((form_errors(form.setUpDate) == '') ? '' : 'is-invalid'), 'placeholder': 'Date de mise en place souhaitée'}}) }}
        <div class="invalid-feedback">{{ form_errors(form.setUpDate) | striptags }}</div>
    </div>
</div>


    <!-- Priority -->
   <div class="form-group-container">
    <div class="form-group margin-top" >
        <div class="form-group1">
            <label>{{ 'action_ralise'|trans }}</label>
            <div class="radiosbutt action-realise">
                {% for chk in form.terminated %}
                    <div class="chk">
                        {{ form_widget(chk, {'attr': {'class': 'custom-control-input'}}) }}
                        {{ form_label(chk, null, {'label_attr': {'class': 'custom-control-label'}}) }}
                    </div>
                {% endfor %}
            </div>
            <div class="invalid-feedback">{{ form_errors(form.terminated) | striptags }}</div>
        </div>
    </div>
</div>

<br>
<div class="form-group-container">
    <div class="form-group margin-top" >
        <div class="form-group1">
            <label>{{ 'priorite'|trans }}</label>
            <div  class="radiosbutt priorite">
                {% for chk in form.priority %}
                    <div class="chk">
                        {{ form_widget(chk, {'attr': {'class': 'custom-control-input'}}) }}
                        {% if loop.index == 1 %}
                            {{ form_label(chk, null, {'label_attr': {'class': 'custom-control-label text-danger'}}) }}
                        {% elseif loop.index == 2 %}
                            {{ form_label(chk, null, {'label_attr': {'class': 'custom-control-label text-warning'}}) }}
                        {% else %}
                            {{ form_label(chk, null, {'label_attr': {'class': 'custom-control-label text-success'}}) }}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="invalid-feedback">{{ form_errors(form.priority) | striptags }}</div>
        </div>
    </div>
</div>


    <!-- Attach Documents -->
<div class="form-group1 margin-top-30">
    <label for="treatments-search" class="margin-bottom-10">{{ 'Traitements liés'|trans }}</label>
      {{ form_widget(form.treatments, {'attr': {'class': 'form-control ' ~ ((form_errors(form.treatments) == '') ? '' : 'is-invalid')} }) }}
                            <div class="invalid-feedback">{{ form_errors(form.treatments) | striptags  }}</div>
</div>


<div class="form-group1">

    <label for="sheets-search" class="margin-bottom-10">{{ form_label(form.sheets) }}</label>
      {{ form_widget(form.sheets, {'attr': {'class': 'form-control js-select2 ' ~ ((form_errors(form.sheets) == '') ? '' : 'is-invalid')} }) }}
                            <div class="invalid-feedback">{{ form_errors(form.sheets) | striptags  }}</div>
</div>

<!-- Hidden input to store selected sheets -->
<input type="hidden" id="selected-sheets" name="selectedSheets" value="" />


<div class=" mt-3" >
    <!-- Custom File Button -->
    <button type="button" class="file-button" id="add_document_button">
        <i class="fa fa-file" aria-hidden="true"></i> {{ 'joindre_un_document'|trans }}
    </button>
<div id="block_old_documents" class="row col-12" >
                              {% for document in action.documents %}
            <div class="form-group col-md-12 d-flex block_document">
                <input class="form-control" type="text" name="appbundle_action_documents_{{ document.id }}" value="{{ document.name }}">
                <a href="{{ path('user_actions_deletedoc', {'action': action.id, 'document': document.id}) }}" class="btn btn-danger ml-2" onclick="return confirm('Confirmer la suppression de ce fichier ?\nCette action actualisera la page, toute autre modification sera perdue.');">
                    <i class="mdi mdi-file-remove"></i>
                </a>
                
<a href="{{ asset('uploads/documents/' ~ document.filename) }}" class="btn btn-info ml-2" target="_blank">
                    <i class="mdi mdi-eye"></i>
                </a>
            </div>
        {% endfor %}
                        </div>
                        <div id="block_documents" class="row col-12" >
                        </div>


 

</div>

 {% if isAdmin %}
                        <div class="custom-control custom-checkbox my-4">
                            {{ form_widget(form.forDpo, {'attr': {'class': 'custom-control-input'}}) }}
                            {{ form_label(form.forDpo, null, {'label_attr': {'class': 'custom-control-label'}}) }}
                        </div>
                    {% endif %}
<div class="form-group">
    <div class="form-group1">
        {{ form_label(form.estimationTime, 'Temps Estimé') }}
        {{ form_widget(form.estimationTime, {
            'attr': {
                'class': 'form-control ' ~ ((form_errors(form.estimationTime) == '') ? '' : 'is-invalid'),
                'placeholder': 'Saisissez le temps estimé'
            }
        }) }}
        <div class="invalid-feedback">{{ form_errors(form.estimationTime) | striptags }}</div>
    </div>
    <div class="form-group1">
        {{ form_label(form.realTime, 'Temps Réel') }}
        {{ form_widget(form.realTime, {
            'attr': {
                'class': 'form-control ' ~ ((form_errors(form.realTime) == '') ? '' : 'is-invalid'),
                'placeholder': 'Saisissez le temps réel'
            }
        }) }}
        <div class="invalid-feedback">{{ form_errors(form.realTime) | striptags }}</div>
    </div>
</div>


    <!-- Submit -->
    <button type="submit" class="submit-button">{{ 'enregistrer'|trans }}</button>
    {{ form_end(form) }}
  </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
         <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
     <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
 <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
     <script>
   
   
     $(document).ready(function() {
            $('.js-select2').select2({
                
                allowClear: true,
                width: '100%'
            });
            inputTreatmentsSelector = $('#appbundle_action_treatments');
                inputTreatmentsSelector.select2({
                
                allowClear: true,
                width: '100%',
                ajax: {
                        url: '{{ path('user_json_treatments') }}',
					                        type: 'POST',
					                        data: function (params) {
					                            return {
					                                name: params.term,
					                            };
					                        },
					                        processResults: function (data) {
					                            if (data) {
					                                return {
					                                    results: data
					                                };
					                            }
					                            return {
					                                results: []
					                            };
					                        }
					                    }
					            });
					        });
					   
					// Tables to dataTables
					(function ($) {
					            'use strict';
					            $(document).ready(function () {
					              
					
					               
					                document.getElementById("add_document_button").addEventListener("click", function () {
					                    var div = document.createElement("div");
					                    div.className = "form-group col-md-12 d-flex block_document";
					
					                    var nameInput = document.createElement("input");
					                    nameInput.className = "form-control";
					                    nameInput.setAttribute("type", "text");
					                    nameInput.setAttribute("placeholder", "Titre");
					                    nameInput.setAttribute("name", "appbundle_action_documents_names[]");
					
					                    var fileInput = document.createElement("input");
					                    fileInput.className = "form-control ml-2";
					                    fileInput.setAttribute("type", "file");
					                    fileInput.setAttribute("name", "appbundle_action_documents[]");
					
					                    var fileInputRemoveButton = document.createElement("button");
					                    fileInputRemoveButton.className = "btn btn-danger ml-2 remove_document_button";
					                    fileInputRemoveButton.setAttribute("type", "button");
					                    fileInputRemoveButton.setAttribute("onclick", "removeDocument(this)");
					
					                
					
					                    div.appendChild(nameInput);
					                    div.appendChild(fileInput);
					                    div.appendChild(fileInputRemoveButton);
					
					                    var element = document.getElementById("block_documents");
					                    element.appendChild(div);
					                });
					            });
					        })(window.jQuery);
					
					function removeDocument(element) {
					    element.parentNode.remove();
					}
					
					function selectStd(e) {
					    saved = true;
					    window.location.href = "{{ path('user_actions_add') }}?std=" + e.value;
					}
					document.addEventListener("DOMContentLoaded", () => {
					
					   flatpickr(".datepicker-js", {
					                dateFormat: "Y-m-d",
					                altInput: true,
					                altFormat: "d/m/Y",
					                locale: "fr",
					                allowInput: true,
					            });
					
					
					  
					
					    
					
					  
					
					
					
					
					
					});


				</script>
				--!#}
			{% endblock %}
